<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Comment Remover</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .light-mode {
            background-color: #f8fafc;
            color: #1f2937;
        }
        .light-mode .bg-gray-900 {
            background-color: #f8fafc;
        }
        .light-mode .bg-gray-800 {
            background-color: #ffffff;
            border-color: #e5e7eb;
        }
        .light-mode .border-gray-700 {
            border-color: #d1d5db;
        }
        .light-mode .border-gray-600 {
            border-color: #d1d5db;
        }
        .light-mode .text-white {
            color: #1f2937;
        }
        .light-mode .text-gray-400 {
            color: #6b7280;
        }
        #inputCode, #outputCode {
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            line-height: 1.5;
        }
        #dropZone.drag-over {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">Advanced Comment Remover</h1>
            <p class="text-gray-400">Production-grade comment removal for 10+ programming languages</p>
            
            <div class="flex justify-center items-center mt-4 space-x-4">
                <button id="themeToggle" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    üåô Dark Mode
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="space-y-4">
                <div class="flex items-center space-x-4">
                    <select id="languageSelect" class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="c">C</option>
                        <option value="go">Go</option>
                        <option value="php">PHP</option>
                        <option value="rust">Rust</option>
                        <option value="ruby">Ruby</option>
                        <option value="typescript">TypeScript</option>
                    </select>
                    
                    <button id="processBtn" class="px-6 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors font-semibold">
                        Remove Comments
                    </button>
                </div>

                <div id="dropZone" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                    <div class="space-y-2">
                        <div class="text-4xl">üìÅ</div>
                        <p class="text-lg">Drop files here or click to upload</p>
                        <p class="text-sm text-gray-400">Supports all major programming languages</p>
                    </div>
                    <input type="file" id="fileInput" class="hidden" multiple accept=".py,.js,.java,.cpp,.c,.go,.php,.rs,.rb,.ts">
                </div>

                <textarea 
                    id="inputCode" 
                    placeholder="Paste your code here..."
                    class="w-full h-96 bg-gray-800 border border-gray-700 rounded-lg p-4 font-mono text-sm focus:ring-2 focus:ring-blue-500 resize-none"
                ></textarea>
            </div>

            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">Processed Code</h3>
                    <div class="flex space-x-2">
                        <button id="copyBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors text-sm">
                            üìã Copy
                        </button>
                        <button id="downloadBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors text-sm">
                            üíæ Download
                        </button>
                    </div>
                </div>

                <div id="stats" class="bg-gray-800 rounded-lg p-4 text-sm">
                    <div class="grid grid-cols-2 gap-4">
                        <div>Original Lines: <span id="originalLines" class="font-semibold text-blue-400">0</span></div>
                        <div>Processed Lines: <span id="processedLines" class="font-semibold text-green-400">0</span></div>
                    </div>
                </div>

                <textarea 
                    id="outputCode" 
                    readonly
                    placeholder="Processed code will appear here..."
                    class="w-full h-96 bg-gray-800 border border-gray-700 rounded-lg p-4 font-mono text-sm resize-none"
                ></textarea>
            </div>
        </div>

        <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-8 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p>Processing your code...</p>
            </div>
        </div>
    </div>

    <script>
        class CommentRemover {
            constructor() {
                this.apiBase = '/api/v1';
                this.isDarkMode = true;
                this.initializeElements();
                this.attachEventListeners();
                this.loadSupportedLanguages();
            }

            initializeElements() {
                this.elements = {
                    languageSelect: document.getElementById('languageSelect'),
                    processBtn: document.getElementById('processBtn'),
                    inputCode: document.getElementById('inputCode'),
                    outputCode: document.getElementById('outputCode'),
                    dropZone: document.getElementById('dropZone'),
                    fileInput: document.getElementById('fileInput'),
                    copyBtn: document.getElementById('copyBtn'),
                    downloadBtn: document.getElementById('downloadBtn'),
                    themeToggle: document.getElementById('themeToggle'),
                    loading: document.getElementById('loading'),
                    originalLines: document.getElementById('originalLines'),
                    processedLines: document.getElementById('processedLines')
                };
            }

            attachEventListeners() {
                this.elements.processBtn.addEventListener('click', () => this.processCode());
                this.elements.copyBtn.addEventListener('click', () => this.copyToClipboard());
                this.elements.downloadBtn.addEventListener('click', () => this.downloadCode());
                this.elements.themeToggle.addEventListener('click', () => this.toggleTheme());
                
                this.elements.dropZone.addEventListener('click', () => this.elements.fileInput.click());
                this.elements.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                
                this.elements.dropZone.addEventListener('dragover', (e) => this.handleDragOver(e));
                this.elements.dropZone.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                this.elements.dropZone.addEventListener('drop', (e) => this.handleDrop(e));
                
                this.elements.inputCode.addEventListener('input', () => this.updateStats());
            }

            async loadSupportedLanguages() {
                try {
                    const response = await fetch(`${this.apiBase}/languages`);
                    const data = await response.json();
                    
                    this.elements.languageSelect.innerHTML = '';
                    data.languages.forEach(lang => {
                        const option = document.createElement('option');
                        option.value = lang;
                        option.textContent = lang.charAt(0).toUpperCase() + lang.slice(1);
                        this.elements.languageSelect.appendChild(option);
                    });
                } catch (error) {
                    console.error('Failed to load languages:', error);
                }
            }

            async processCode() {
                const code = this.elements.inputCode.value.trim();
                if (!code) {
                    this.showNotification('Please enter some code to process', 'error');
                    return;
                }

                this.showLoading(true);
                
                try {
                    const response = await fetch(`${this.apiBase}/process`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            code: code,
                            language: this.elements.languageSelect.value,
                            preserve_structure: true
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    this.elements.outputCode.value = result.processed_code;
                    this.elements.originalLines.textContent = result.original_lines;
                    this.elements.processedLines.textContent = result.processed_lines;
                    
                    this.showNotification('Code processed successfully!', 'success');
                    
                } catch (error) {
                    console.error('Processing error:', error);
                    this.showNotification('Failed to process code. Please try again.', 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            handleFileSelect(event) {
                const files = Array.from(event.target.files);
                if (files.length > 0) {
                    this.processFiles(files);
                }
            }

            handleDragOver(event) {
                event.preventDefault();
                this.elements.dropZone.classList.add('drag-over');
            }

            handleDragLeave(event) {
                event.preventDefault();
                this.elements.dropZone.classList.remove('drag-over');
            }

            handleDrop(event) {
                event.preventDefault();
                this.elements.dropZone.classList.remove('drag-over');
                
                const files = Array.from(event.dataTransfer.files);
                if (files.length > 0) {
                    this.processFiles(files);
                }
            }

            async processFiles(files) {
                if (files.length === 1) {
                    const file = files[0];
                    const content = await this.readFileContent(file);
                    this.elements.inputCode.value = content;
                    
                    const extension = file.name.split('.').pop().toLowerCase();
                    const languageMap = {
                        'py': 'python',
                        'js': 'javascript',
                        'ts': 'typescript',
                        'java': 'java',
                        'cpp': 'cpp',
                        'c': 'c',
                        'go': 'go',
                        'php': 'php',
                        'rs': 'rust',
                        'rb': 'ruby'
                    };
                    
                    if (languageMap[extension]) {
                        this.elements.languageSelect.value = languageMap[extension];
                    }
                    
                    this.updateStats();
                    this.showNotification(`Loaded ${file.name}`, 'success');
                }
            }

            readFileContent(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(e);
                    reader.readAsText(file);
                });
            }

            copyToClipboard() {
                const output = this.elements.outputCode.value;
                if (!output) {
                    this.showNotification('No processed code to copy', 'error');
                    return;
                }

                navigator.clipboard.writeText(output).then(() => {
                    this.showNotification('Code copied to clipboard!', 'success');
                }).catch(() => {
                    this.showNotification('Failed to copy code', 'error');
                });
            }

            downloadCode() {
                const output = this.elements.outputCode.value;
                if (!output) {
                    this.showNotification('No processed code to download', 'error');
                    return;
                }

                const language = this.elements.languageSelect.value;
                const extensions = {
                    'python': 'py',
                    'javascript': 'js',
                    'typescript': 'ts',
                    'java': 'java',
                    'cpp': 'cpp',
                    'c': 'c',
                    'go': 'go',
                    'php': 'php',
                    'rust': 'rs',
                    'ruby': 'rb'
                };

                const extension = extensions[language] || 'txt';
                const filename = `processed_code.${extension}`;

                const blob = new Blob([output], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                this.showNotification(`Downloaded ${filename}`, 'success');
            }

            toggleTheme() {
                this.isDarkMode = !this.isDarkMode;
                document.body.classList.toggle('light-mode', !this.isDarkMode);
                this.elements.themeToggle.textContent = this.isDarkMode ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode';
            }

            updateStats() {
                const code = this.elements.inputCode.value;
                const lines = code.split('\\n').filter(line => line.trim()).length;
                this.elements.originalLines.textContent = lines;
            }

            showLoading(show) {
                this.elements.loading.classList.toggle('hidden', !show);
            }

            showNotification(message, type) {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
                    type === 'success' ? 'bg-green-600' : 'bg-red-600'
                }`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 3000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new CommentRemover();
        });
    </script>
</body>
</html>